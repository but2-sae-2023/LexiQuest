<!-- compte.html va devenir compte.tsx une fois que j'aurais fusionner le tout en React -->
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type= "text/css" href=style/style.css>
        <link rel="stylesheet" type= "text/css" href=style/compte.css>
        <link rel="stylesheet" type= "text/css" href=style/header.css>

        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://code.highcharts.com/modules/data.js"></script>
        <script src="https://code.highcharts.com/modules/drilldown.js"></script>
        <script src="https://code.highcharts.com/modules/exporting.js"></script>
        <script src="https://code.highcharts.com/modules/export-data.js"></script>
        <script src="https://code.highcharts.com/modules/accessibility.js"></script>

        <title>Compte</title>
    </head>
    <body>
        <!-- Header.tsx-->
        <header>
            <img src="data/img/logo.png" alt="logo de LexiQuest">
            <h1>LexiQuest</h1>
            <a href="compte.html">
                    <!-- fetch les données de l'img et du nom d'utilisateur -->
                    <img id='img_compte' 
                    src="https://media.discordapp.net/attachments/1180876461889048579/1192913030065950740/furina.jpg?ex=65e22cd5&is=65cfb7d5&hm=3f0536ff85925ce1697dd2acc646bbfcfda95c9a803351234d4bf8a266087213&=&format=webp&width=1173&height=660" 
                    alt="img_profile">
                    <h2 id='nom_compte'>Votre nom</h2>
            </a>
            
        </header>

        <!-- infos.tsx-->
        <main>
            <!-- function infos-->
            <section id="infos">
                <h1>Vos informations</h1>
                <ul>
                    <li>
                        <img id='img_compte' 
                        src="https://media.discordapp.net/attachments/1180876461889048579/1192913030065950740/furina.jpg?ex=65e22cd5&is=65cfb7d5&hm=3f0536ff85925ce1697dd2acc646bbfcfda95c9a803351234d4bf8a266087213&=&format=webp&width=1173&height=660" 
                        alt="img_profile">
                    </li>
                    <li>
                        <h2 id="pseudo">Nom d'utilisateur: undefine</h2>
                        <img src="data/img/bouton-modifier.png" alt="Changer l'élement">
                    </li>
                    <li>
                        <h2>Mdp: ************</h2>
                        <img src="data/img/bouton-modifier.png" alt="Changer l'élement">
                    </li>
                    <li>
                        <h2 id="email">Adresse e-mail: undefine@undefine.com</h2>
                        <img src="data/img/bouton-modifier.png" alt="Changer l'élement">
                    </li>
                    <li>
                        <h2 id="birthyear">Année de naissance: undefine</h2>
                        <img src="data/img/bouton-modifier.png" alt="Changer l'élement">
                    </li>
                    <li>
                        <h2 id="signup">Date d’inscription: undefine</h2>
                    </li>
                </ul>
            </section>

            <!-- function stats-->
            <section id="stats">
                <h1>Stats de parties</h1>
                <h2 id="nb_parties">Parties joués: 20 parties</h2>
                <figure class="highcharts-figure">
                    <div id="graph"></div>
                </figure>
            </section>
        </main>
    </body>
</html>


<script>
    // Définir arrayData en dehors de la fonction getUserData()
    let arrayData;

    // Fonction pour récupérer les données de session via AJAX
    function getUserData() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    var user = JSON.parse(xhr.responseText);
                    
                    
                    //let array = [];

                    for(let v in user){
                        user[v.replaceAll('\u0000','')] = user[v];
                        delete user[v];
                        //array.push(v.replaceAll('\u0000',''));
                    }

                    //console.log(array);

                    // Utiliser les données de $_SESSION['user'] récupérées
                    document.getElementById('img_compte').src;
                    document.getElementById('nom_compte').textContent = user["Userusername"];

                    document.getElementById('pseudo').textContent = 'Pseudo: ' + user["Userusername"];
                    document.getElementById('email').textContent = 'Adresse e-mail: ' + user["Useremail"];
                    document.getElementById('birthyear').textContent = 'Année de naissance : ' + user["Userbirth_year"];
                    document.getElementById('signup').textContent = 'Date d’inscription: ' + user["Userdate_signup"];

                    document.getElementById('nb_parties').textContent = 'Nombre de parties totales: ' + user["Usernb_game_played"];
                    

                    arrayData = [
                        {
                            name: 'Score max',
                            y: user["Usermax_score"]
                        },
                        {
                            name: 'Score moyen',
                            y: parseFloat(user["Useravg_score"])
                        },
                        {
                            name: 'Score min',
                            y: user["Usermin_score"]
                        }
                    ];
                    createGraph(arrayData);
                } else {
                    console.error('Erreur de récupération des données de session : ' + xhr.statusText);
                }
            }
        };
        xhr.open('GET', 'get_user_data.php', true);
        xhr.send();
        
    }

    // Appeler la fonction pour récupérer les données de session
    arrayData = getUserData();
    

    function createGraph(arrayData){
        Highcharts.chart('graph', {
            chart: {
                type: 'column'
            },
            title: {
                align: 'left',
                text: 'Stats de parties '
            },
            accessibility: {
                announceNewData: {
                    enabled: true
                }
            },
            xAxis: {
                type: 'category'
            },
            yAxis: {
                title: {
                    text: 'Total de points'
                }
            },
            legend: {
                enabled: false
            },
            plotOptions: {
                series: {
                    borderWidth: 0,
                    dataLabels: {
                        enabled: true,
                        format: '{point.y:.2f}'
                    }
                }
            },
            tooltip: {
                pointFormat: '<b>{point.y:.2f}</b><br/>'
            },
            series: [{
                name: 'Catégories',
                colorByPoint: true,
                data: arrayData
            }],
        });
    }
    
</script>
